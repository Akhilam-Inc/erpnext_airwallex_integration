{% extends "templates/docs_page.html" %}

{% block title %}Bank Account Mapping - Bank Integration Documentation{% endblock %}

{% block page_title %}Bank Account Mapping{% endblock %}
{% block page_subtitle %}Configure mappings between Airwallex and ERPNext accounts{% endblock %}

{% block page_content %}
<h1>Bank Account Mapping</h1>

<p>Proper bank account mapping is essential for accurate transaction synchronization between Airwallex and ERPNext.</p>

<h2>Understanding Account Mapping</h2>

<p>Bank account mapping connects your Airwallex multi-currency wallets with corresponding ERPNext bank accounts. This ensures transactions are recorded in the correct accounts based on their currency.</p>

<h3>Why Mapping is Important</h3>
<ul>
    <li>üéØ <strong>Accurate Recording:</strong> Ensures transactions go to the right accounts</li>
    <li>üí∞ <strong>Multi-Currency Support:</strong> Handles different currencies properly</li>
    <li>üìä <strong>Financial Reporting:</strong> Maintains clean financial records</li>
    <li>‚öñÔ∏è <strong>Reconciliation:</strong> Simplifies bank reconciliation process</li>
</ul>

<h2>Setting Up Bank Accounts in ERPNext</h2>

<h3>Creating Bank Accounts</h3>
<ol>
    <li>Navigate to <strong>Accounting ‚Üí Chart of Accounts</strong></li>
    <li>Find your <strong>Bank Accounts</strong> group</li>
    <li>Click <strong>"Add Child"</strong></li>
    <li>Configure the account:
        <ul>
            <li><strong>Account Name:</strong> Descriptive name (e.g., "Airwallex USD Account")</li>
            <li><strong>Account Type:</strong> Bank</li>
            <li><strong>Account Currency:</strong> Select appropriate currency</li>
            <li><strong>Is Group:</strong> Unchecked</li>
        </ul>
    </li>
    <li>Save the account</li>
</ol>

<h2>Configuring Mappings</h2>

<h3>Adding Currency Mappings</h3>
<ol>
    <li>Open <strong>Bank Integration Setting</strong></li>
    <li>Scroll to <strong>"Bank Account Mappings"</strong> section</li>
    <li>Click <strong>"Add Row"</strong></li>
    <li>Configure each mapping:
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Field</th>
                    <th>Description</th>
                    <th>Example</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Bank Account</strong></td>
                    <td>ERPNext bank account</td>
                    <td>Airwallex USD - Company</td>
                </tr>
                <tr>
                    <td><strong>Currency</strong></td>
                    <td>3-letter currency code</td>
                    <td>USD</td>
                </tr>
            </tbody>
        </table>
    </li>
    <li>Save the document</li>
</ol>

<h2>Recommended Mapping Structure</h2>

<h3>Standard Multi-Currency Setup</h3>
<div class="feature-highlight">
    <h4>Example Mappings</h4>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Currency</th>
                <th>ERPNext Bank Account</th>
                <th>Account Code</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>USD</td>
                <td>Airwallex USD - Company</td>
                <td>1210-001</td>
            </tr>
            <tr>
                <td>EUR</td>
                <td>Airwallex EUR - Company</td>
                <td>1210-002</td>
            </tr>
            <tr>
                <td>GBP</td>
                <td>Airwallex GBP - Company</td>
                <td>1210-003</td>
            </tr>
            <tr>
                <td>AUD</td>
                <td>Airwallex AUD - Company</td>
                <td>1210-004</td>
            </tr>
            <tr>
                <td>SGD</td>
                <td>Airwallex SGD - Company</td>
                <td>1210-005</td>
            </tr>
        </tbody>
    </table>
</div>

<h2>Mapping Logic</h2>

<h3>How Transactions are Mapped</h3>
<p>When a transaction is synced, the system follows this logic:</p>

<ol>
    <li><strong>Currency Check:</strong> Identify transaction currency from Airwallex</li>
    <li><strong>Mapping Lookup:</strong> Find corresponding ERPNext bank account</li>
    <li><strong>Account Assignment:</strong> Assign transaction to mapped account</li>
    <li><strong>Fallback Logic:</strong> Use default account if no mapping found</li>
</ol>

<h3>Fallback Mechanism</h3>
<p>If no mapping is found for a currency, the system will:</p>
<ol>
    <li>Search for any bank account with matching currency</li>
    <li>Create a default account name like "Airwallex {Currency} Account"</li>
    <li>Log a warning for manual review</li>
</ol>

<div class="alert alert-warning">
    <strong>Important:</strong> Always create proper mappings to avoid transactions going to unexpected accounts.
</div>

<h2>Best Practices</h2>

<h3>Naming Conventions</h3>
<ul>
    <li><strong>Consistent Naming:</strong> Use "Airwallex {Currency} - {Company}" format</li>
    <li><strong>Currency Codes:</strong> Always use 3-letter ISO currency codes</li>
    <li><strong>Clear Descriptions:</strong> Include bank name and currency in descriptions</li>
</ul>

<h2>Troubleshooting Mapping Issues</h2>

<h3>Transactions in Wrong Accounts</h3>
<div class="alert alert-warning">
    <strong>Problem:</strong> Transactions appear in unexpected bank accounts
    <br><strong>Solutions:</strong>
    <ul>
        <li>Verify currency mapping is correct</li>
        <li>Check account names match exactly</li>
        <li>Ensure accounts exist in Chart of Accounts</li>
    </ul>
</div>

<h3>Missing Bank Accounts</h3>
<div class="alert alert-warning">
    <strong>Problem:</strong> Sync fails with "Bank account not found" error
    <br><strong>Solutions:</strong>
    <ul>
        <li>Create missing bank accounts in ERPNext</li>
        <li>Update mappings with correct account names</li>
        <li>Check account permissions and company assignment</li>
    </ul>
</div>

<div style="margin-top: 40px; text-align: center;">
    <a href="/docs/troubleshooting" class="btn btn-primary">Next: Troubleshooting ‚Üí</a>
</div>
{% endblock %}
